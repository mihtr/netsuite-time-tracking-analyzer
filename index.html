<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NetSuite Time Tracking Analyzer</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --bg-tertiary: #e9ecef;
            --text-primary: #212529;
            --text-secondary: #495057;
            --text-tertiary: #6c757d;
            --border-color: #dee2e6;
            --card-shadow: rgba(0,0,0,0.08);
            --modal-bg: rgba(0,0,0,0.7);
        }

        body.dark-mode {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --bg-tertiary: #3a3a3a;
            --text-primary: #e0e0e0;
            --text-secondary: #b0b0b0;
            --text-tertiary: #888888;
            --border-color: #444444;
            --card-shadow: rgba(0,0,0,0.3);
            --modal-bg: rgba(0,0,0,0.85);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 0;
            margin: 0;
            overflow-y: auto;
        }

        .container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            background: var(--bg-primary);
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 30px;
            text-align: center;
            flex-shrink: 0;
            position: relative;
        }

        /* Top Menu Bar */
        .top-menu-bar {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            padding-bottom: 10px;
            flex-wrap: wrap;
        }

        .menu-item {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 0.95em;
            font-weight: 600;
            cursor: pointer;
            padding: 10px 20px;
            border-radius: 8px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .menu-item:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .menu-item:active {
            transform: translateY(0);
        }

        h1 {
            font-size: 1.8em;
            margin-bottom: 5px;
        }

        .subtitle {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .controls {
            padding: 8px 20px;
            background: var(--bg-secondary);
            border-bottom: 2px solid var(--border-color);
            flex-shrink: 0;
        }

        .filter-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 8px;
            margin-bottom: 8px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            min-width: 0; /* Prevent overflow in grid items */
        }

        .filter-group label {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        label {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--text-secondary);
            font-size: 0.75em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .clear-filter-btn {
            background: transparent;
            border: none;
            color: #dc3545;
            font-size: 1.2em;
            cursor: pointer;
            padding: 0;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s ease;
            line-height: 1;
        }

        .clear-filter-btn:hover {
            background: #dc3545;
            color: white;
            transform: scale(1.1);
        }

        input, select {
            padding: 6px;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            font-size: 0.95em;
            transition: all 0.3s ease;
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        select[multiple] {
            padding: 6px;
        }

        select[multiple] option {
            padding: 8px;
            border-radius: 4px;
            margin: 2px 0;
        }

        select[multiple] option:checked {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .button-group {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }

        button {
            padding: 7px 18px;
            border: none;
            border-radius: 5px;
            font-size: 0.8em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        button:disabled:hover {
            transform: none !important;
            box-shadow: none !important;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            padding: 8px 30px;
            background: var(--bg-secondary);
            flex-shrink: 0;
        }

        .stat-card {
            background: var(--bg-primary);
            padding: 6px 10px;
            border-radius: 6px;
            box-shadow: 0 1px 4px var(--card-shadow);
            border-left: 3px solid #667eea;
        }

        .stat-label {
            font-size: 0.65em;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 3px;
        }

        .stat-value {
            font-size: 1.2em;
            font-weight: 700;
            color: var(--text-primary);
        }

        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }

        .insight-card {
            background: var(--bg-primary);
            padding: 12px;
            border-radius: 6px;
            box-shadow: 0 1px 4px var(--card-shadow);
            display: flex;
            gap: 12px;
            align-items: center;
            border-left: 3px solid #667eea;
        }

        .insight-icon {
            font-size: 2em;
            line-height: 1;
        }

        .insight-content {
            flex: 1;
        }

        .insight-label {
            font-size: 0.7em;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .insight-value {
            font-size: 1.1em;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 2px;
        }

        .insight-detail {
            font-size: 0.75em;
            color: var(--text-tertiary);
        }

        .tabs {
            display: flex;
            background: var(--bg-secondary);
            border-bottom: 2px solid var(--border-color);
            padding: 0 30px;
            flex-shrink: 0;
        }

        .tab {
            padding: 15px 25px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-weight: 600;
            color: var(--text-tertiary);
            transition: all 0.3s ease;
            user-select: none;
        }

        .tab:hover {
            color: var(--text-secondary);
            background: rgba(102, 126, 234, 0.05);
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
            background: var(--bg-primary);
        }

        .view-container {
            display: none;
        }

        .view-container.active {
            display: flex;
            flex-direction: column;
        }

        .table-container {
            padding: 0;
        }

        .pivot-table-container {
            padding: 0 30px 20px 30px;
            overflow-x: auto;
            position: relative;
        }

        .pivot-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85em;
        }

        .pivot-table th.row-header {
            text-align: left;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 600;
            padding: 10px 12px;
            position: -webkit-sticky;
            position: sticky;
            left: 0;
            top: 0;
            z-index: 5;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
            border-right: 2px solid #5568d3;
        }

        .pivot-table th.row-header:hover {
            background: linear-gradient(135deg, #5568d3 0%, #6639a3 100%);
            cursor: pointer;
        }

        .pivot-table th.month-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
            font-weight: 600;
            padding: 10px 8px;
            min-width: 100px;
            position: -webkit-sticky;
            position: sticky;
            top: 0;
            z-index: 4;
        }

        .pivot-table th.month-header:hover {
            background: linear-gradient(135deg, #5568d3 0%, #6639a3 100%);
            cursor: pointer;
        }

        .pivot-table td {
            text-align: right;
            padding: 10px 12px;
        }

        .pivot-table td.row-label {
            text-align: left;
            font-weight: 500;
            background: #f8f9fa;
            position: sticky;
            z-index: 2;
            box-shadow: 2px 0 5px rgba(0,0,0,0.05);
            padding: 10px 12px;
        }

        /* Position each sticky column progressively */
        .pivot-table td.row-label:nth-child(1),
        .pivot-table th.row-header:nth-child(1) {
            left: 0;
        }

        .pivot-table td.row-label:nth-child(2),
        .pivot-table th.row-header:nth-child(2) {
            left: 150px;
        }

        .pivot-table td.row-label:nth-child(3),
        .pivot-table th.row-header:nth-child(3) {
            left: 300px;
        }

        .pivot-table td.row-label:nth-child(4),
        .pivot-table th.row-header:nth-child(4) {
            left: 450px;
        }

        .pivot-table td.row-label:nth-child(5),
        .pivot-table th.row-header:nth-child(5) {
            left: 600px;
        }

        .pivot-table tr.total-row {
            background: #667eea;
            color: white;
            font-weight: bold;
        }

        .pivot-table tr.total-row td {
            border-top: 3px solid #764ba2;
        }

        .pivot-table tbody tr:hover {
            background: rgba(102, 126, 234, 0.05);
        }

        .pivot-table td.zero {
            color: #ccc;
        }

        .pivot-table td.has-value {
            color: #212529;
            font-weight: 500;
        }

        /* Dark mode support for pivot table sticky row labels */
        body.dark-mode .pivot-table td.row-label {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        body.dark-mode .pivot-table td.has-value {
            color: var(--text-primary);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.95em;
        }

        thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        th {
            padding: 12px 15px;
            text-align: left;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 0.8em;
            position: sticky;
            top: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            z-index: 10;
            cursor: pointer;
            user-select: none;
        }

        th:hover {
            background: linear-gradient(135deg, #5a6fd4 0%, #6a428c 100%);
        }

        th.sortable::after {
            content: ' ‚áÖ';
            opacity: 0.5;
        }

        th.sort-asc::after {
            content: ' ‚Üë';
            opacity: 1;
        }

        th.sort-desc::after {
            content: ' ‚Üì';
            opacity: 1;
        }

        td {
            padding: 10px 15px;
            border-bottom: 1px solid #e9ecef;
            font-size: 0.9em;
        }

        tbody tr {
            transition: background 0.2s ease;
        }

        tbody tr:hover {
            background: #f8f9fa;
        }

        tbody tr:nth-child(even) {
            background: #f8f9fa;
        }

        tbody tr:nth-child(even):hover {
            background: #e9ecef;
        }

        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.2em;
            color: #6c757d;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .no-data {
            text-align: center;
            padding: 50px;
            color: #6c757d;
            font-size: 1.2em;
        }

        .file-upload {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .file-label {
            display: inline-block;
            padding: 12px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.3s ease;
        }

        .file-label:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        input[type="file"] {
            display: none;
        }

        .file-name {
            color: #495057;
            font-style: italic;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 6px;
            margin: 20px 30px;
            border-left: 4px solid #f5c6cb;
        }

        .success {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 6px;
            margin: 20px 30px;
            border-left: 4px solid #c3e6cb;
        }

        /* Additional Analytics Styles */
        .analytics-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 12px;
        }

        .analytics-card {
            background: white;
            padding: 12px;
            border-radius: 6px;
            box-shadow: 0 1px 4px rgba(0,0,0,0.08);
            border-left: 3px solid #667eea;
        }

        .analytics-title {
            font-size: 0.75em;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .analytics-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .analytics-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85em;
        }

        .analytics-rank {
            font-weight: 700;
            color: #667eea;
            min-width: 18px;
        }

        .analytics-name {
            flex: 1;
            color: #495057;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .analytics-value {
            font-weight: 600;
            color: #212529;
            margin-right: 6px;
        }

        .analytics-percent {
            font-size: 0.85em;
            color: #6c757d;
        }

        .analytics-bar-container {
            flex: 1;
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            overflow: hidden;
            max-width: 100px;
        }

        .analytics-bar {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        /* Suggested Improvements Styles */
        .improvements-header {
            font-size: 0.85em;
            font-weight: 700;
            color: #856404;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .improvements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 12px;
        }

        .improvement-card {
            background: white;
            padding: 12px;
            border-radius: 6px;
            box-shadow: 0 1px 4px rgba(0,0,0,0.08);
            border-left: 4px solid #ffc107;
        }

        .improvement-card.warning {
            border-left-color: #ff9800;
        }

        .improvement-card.alert {
            border-left-color: #f44336;
        }

        .improvement-title {
            font-size: 0.85em;
            font-weight: 700;
            color: #856404;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .improvement-icon {
            font-size: 1.2em;
        }

        .improvement-content {
            font-size: 0.8em;
            color: #6c757d;
            line-height: 1.5;
        }

        .improvement-list {
            margin: 6px 0 0 0;
            padding-left: 20px;
        }

        .improvement-list li {
            margin: 4px 0;
            color: #495057;
        }

        .improvement-metric {
            font-weight: 600;
            color: #212529;
        }

        /* Date Validation Styles */
        .date-input-wrapper {
            position: relative;
            width: 100%;
        }

        .date-input-wrapper input {
            width: 100%;
            box-sizing: border-box;
        }

        .date-error {
            color: #dc3545;
            font-size: 0.7em;
            margin-top: 3px;
            display: none;
            position: absolute;
            white-space: nowrap;
            z-index: 10;
        }

        .date-error.show {
            display: block;
        }

        input.invalid-date {
            border-color: #dc3545 !important;
            background-color: #fff5f5;
        }

        input.valid-date {
            border-color: #28a745 !important;
        }

        /* Settings Modal */
        .settings-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--modal-bg);
            z-index: 10000;
            overflow: auto;
            animation: fadeIn 0.2s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .settings-content {
            position: relative;
            margin: 50px auto;
            max-width: 500px;
            background: var(--bg-primary);
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                transform: translateY(-30px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
        }

        .settings-title {
            font-size: 1.5em;
            font-weight: 700;
            color: var(--text-primary);
        }

        .settings-close {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1.1em;
            transition: all 0.3s ease;
        }

        .settings-close:hover {
            background: #c82333;
            transform: scale(1.05);
        }

        .settings-section {
            margin-bottom: 25px;
        }

        .settings-section-title {
            font-size: 0.9em;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: var(--bg-secondary);
            border-radius: 8px;
            margin-bottom: 10px;
            transition: all 0.2s ease;
        }

        .setting-item:hover {
            background: var(--bg-tertiary);
        }

        .setting-label {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .setting-name {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 1em;
        }

        .setting-description {
            font-size: 0.8em;
            color: var(--text-tertiary);
        }

        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.3s;
            border-radius: 26px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }

        .toggle-switch input:checked + .toggle-slider {
            background-color: #667eea;
        }

        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }

        .toggle-slider:hover {
            opacity: 0.9;
        }

        /* Decimal Separator Select */
        .setting-select {
            padding: 8px 12px;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .setting-select:hover {
            border-color: #667eea;
        }

        .setting-select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .setting-input {
            padding: 8px 12px;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 1em;
            width: 100px;
            transition: all 0.3s ease;
        }

        .setting-input:hover {
            border-color: #667eea;
        }

        .setting-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .setting-textarea {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 0.9em;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            resize: vertical;
            min-height: 60px;
            transition: all 0.2s ease;
        }

        .setting-textarea:hover {
            border-color: #667eea;
        }

        .setting-textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .setting-button {
            padding: 8px 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95em;
            transition: all 0.3s ease;
        }

        .setting-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .setting-button:active {
            transform: translateY(0);
        }

        /* Employee Filter Dropdown */
        .employee-filter-container {
            position: relative;
            display: inline-block;
        }

        .employee-filter-button {
            padding: 8px 12px;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            color: var(--text-primary);
            cursor: pointer;
            min-width: 200px;
            text-align: left;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .employee-filter-button:hover {
            border-color: #667eea;
            background: var(--bg-secondary);
        }

        .employee-filter-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 4px;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            box-shadow: 0 4px 12px var(--card-shadow);
            z-index: 1000;
            min-width: 280px;
        }

        .employee-filter-dropdown label {
            display: flex;
            align-items: center;
            padding: 6px 4px;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .employee-filter-dropdown label:hover {
            background: var(--bg-secondary);
        }

        .employee-filter-dropdown input[type="checkbox"] {
            cursor: pointer;
        }

        /* Employee Hover Popup */
        .employee-popup {
            position: fixed;
            background: var(--bg-primary);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            padding: 16px;
            z-index: 10000;
            max-width: 650px;
            min-width: 500px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .employee-popup.show {
            opacity: 1;
        }

        .employee-popup-header {
            font-weight: 600;
            font-size: 1.1em;
            color: var(--text-primary);
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--border-color);
        }

        .employee-popup-section {
            margin-bottom: 12px;
        }

        .employee-popup-section:last-child {
            margin-bottom: 0;
        }

        .employee-popup-section-title {
            font-weight: 600;
            font-size: 0.9em;
            color: #667eea;
            margin-bottom: 6px;
        }

        .employee-popup-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 8px;
        }

        .employee-popup-stat {
            display: flex;
            justify-content: space-between;
            padding: 4px 8px;
            background: var(--bg-secondary);
            border-radius: 4px;
            font-size: 0.85em;
        }

        .employee-popup-stat-label {
            color: var(--text-secondary);
        }

        .employee-popup-stat-value {
            font-weight: 600;
            color: var(--text-primary);
        }

        .employee-popup-list {
            font-size: 0.85em;
        }

        .employee-popup-list-item {
            display: flex;
            justify-content: space-between;
            padding: 3px 6px;
            margin-bottom: 2px;
            background: var(--bg-secondary);
            border-radius: 3px;
        }

        .employee-popup-list-item-name {
            color: var(--text-secondary);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            flex: 1;
            margin-right: 8px;
        }

        .employee-popup-list-item-value {
            font-weight: 600;
            color: var(--text-primary);
            white-space: nowrap;
        }

        .employee-name-hover {
            cursor: help;
            text-decoration: underline;
            text-decoration-style: dotted;
            text-decoration-color: var(--text-tertiary);
        }

        .employee-name-hover:hover {
            color: #667eea;
        }
        /* Recommendations Styles */
        .recommendations-container {
            padding: 20px 30px;
            background: var(--bg-primary);
        }

        .recommendations-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .recommendations-title {
            color: var(--text-secondary);
            margin: 0;
        }

        .recommendations-summary {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
        }

        .rec-summary-card {
            flex: 1;
            padding: 15px 20px;
            border-radius: 8px;
            text-align: center;
        }

        .rec-summary-card.critical {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
        }

        .rec-summary-card.warning {
            background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%);
            color: white;
        }

        .rec-summary-card.info {
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
            color: white;
        }

        .rec-summary-card.success {
            background: linear-gradient(135deg, #28a745 0%, #218838 100%);
            color: white;
        }

        .rec-summary-number {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .rec-summary-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .recommendations-filters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-chip {
            padding: 8px 16px;
            border-radius: 20px;
            border: 2px solid var(--border-color);
            background: var(--bg-primary);
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .filter-chip:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .filter-chip.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }

        .recommendations-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .recommendation-card {
            background: var(--bg-secondary);
            border-left: 4px solid;
            border-radius: 8px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .recommendation-card:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .recommendation-card.critical {
            border-left-color: #dc3545;
        }

        .recommendation-card.warning {
            border-left-color: #ffc107;
        }

        .recommendation-card.info {
            border-left-color: #17a2b8;
        }

        .recommendation-card.success {
            border-left-color: #28a745;
        }

        .rec-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .rec-title-row {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }

        .rec-icon {
            font-size: 1.5em;
        }

        .rec-title {
            font-size: 1.1em;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
        }

        .rec-category {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .rec-category.resource {
            background: #e3f2fd;
            color: #1976d2;
        }

        .rec-category.billing {
            background: #fff3e0;
            color: #f57c00;
        }

        .rec-category.quality {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        .rec-category.project {
            background: #e8f5e9;
            color: #388e3c;
        }

        .rec-message {
            color: var(--text-secondary);
            line-height: 1.6;
            margin: 10px 0;
        }

        .rec-action {
            padding: 8px 16px;
            background: var(--bg-primary);
            border: 2px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-tertiary);
            font-weight: 500;
            margin-top: 10px;
            display: inline-block;
        }

        .rec-details {
            display: flex;
            gap: 20px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
            font-size: 0.9em;
        }

        .rec-detail-item {
            display: flex;
            align-items: center;
            gap: 5px;
            color: var(--text-tertiary);
        }

        .rec-detail-label {
            font-weight: 600;
        }

        .rec-detail-value {
            color: var(--text-secondary);
        }

        .no-recommendations {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-tertiary);
        }

        .no-recommendations-icon {
            font-size: 4em;
            margin-bottom: 20px;
        }

        .no-recommendations-title {
            font-size: 1.5em;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }

        .no-recommendations-message {
            font-size: 1.1em;
        }

        /* =========================================
           INSIGHTS DASHBOARD STYLES
           ========================================= */
        .insights-section {
            margin-bottom: 30px;
            padding: 20px;
            background: var(--bg-primary);
            border-radius: 8px;
        }

        .insights-section-title {
            font-size: 1.5em;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--text-primary);
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 10px;
        }

        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .insights-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
        }

        .insights-card.full-width {
            grid-column: 1 / -1;
        }

        .insights-card.alert-warning {
            border-left: 4px solid #dc3545;
            background: var(--bg-secondary);
        }

        .insights-card.alert-info {
            border-left: 4px solid #ffc107;
            background: var(--bg-secondary);
        }

        .insights-card h4 {
            font-size: 1.1em;
            font-weight: 600;
            margin: 0 0 15px 0;
            color: var(--text-primary);
        }

        .insights-chart-container {
            height: 300px;
            margin: 15px 0;
        }

        .insights-table {
            margin-top: 15px;
        }

        .insights-table table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9em;
        }

        .insights-table th {
            background: var(--bg-tertiary);
            padding: 8px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid var(--border-color);
        }

        .insights-table td {
            padding: 8px;
            border-bottom: 1px solid var(--border-color);
        }

        .insights-table tr:hover {
            background: var(--bg-tertiary);
        }

        .insights-stat-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .insights-stat {
            background: var(--bg-tertiary);
            border-radius: 6px;
            padding: 15px;
            text-align: center;
        }

        .insights-stat-label {
            font-size: 0.9em;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .insights-stat-value {
            font-size: 1.8em;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .insights-stat-detail {
            font-size: 0.85em;
            color: var(--text-tertiary);
        }

        /* Responsive adjustments for insights */
        @media (max-width: 1200px) {
            .insights-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìä NetSuite Time Tracking Analyzer</h1>
            <p class="subtitle">View and analyze time tracking data with advanced filtering <span style="opacity: 0.7; font-size: 0.85em;">v1.32.0</span></p>

            <!-- Top Menu Bar -->
            <div class="top-menu-bar">
                <button class="menu-item" onclick="openDataImport()" title="Import CSV Data">
                    üìÅ Data Import
                </button>
                <button class="menu-item" onclick="openAnomalyDetection()" title="View Data Anomalies">
                    ‚ö†Ô∏è Anomaly Detection
                </button>
                <button class="menu-item" onclick="openSettings()" title="Application Settings">
                    ‚öôÔ∏è Settings
                </button>
            </div>
        </header>

        <div class="controls">
            <div id="fileUploadSection" class="file-upload" style="margin-bottom: 8px;">
                <label for="csvFile" class="file-label">Load CSV File</label>
                <input type="file" id="csvFile" accept=".csv">
                <span class="file-name" id="fileName">Loading from directory...</span>
            </div>

            <div class="filter-section">
                <div class="filter-group" style="grid-column: 1 / -1;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <label for="searchBox">üîç Search (across all fields)</label>
                        <button class="clear-filter-btn" onclick="clearSearch()" title="Clear search">‚úï</button>
                    </div>
                    <input type="text" id="searchBox" placeholder="Search in all columns..." style="width: 100%;">
                </div>

                <div class="filter-group">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <label for="dateFrom">Date From (DD/MM/YYYY)</label>
                        <button class="clear-filter-btn" onclick="clearDateFrom()" title="Clear date from">‚úï</button>
                    </div>
                    <div class="date-input-wrapper">
                        <input type="text" id="dateFrom" placeholder="DD/MM/YYYY" maxlength="10">
                        <div class="date-error" id="dateFromError">Invalid date format. Use DD/MM/YYYY</div>
                    </div>
                </div>
                <div class="filter-group">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <label for="dateTo">Date To (DD/MM/YYYY)</label>
                        <button class="clear-filter-btn" onclick="clearDateTo()" title="Clear date to">‚úï</button>
                    </div>
                    <div class="date-input-wrapper">
                        <input type="text" id="dateTo" placeholder="DD/MM/YYYY" maxlength="10">
                        <div class="date-error" id="dateToError">Invalid date format. Use DD/MM/YYYY</div>
                    </div>
                </div>
            </div>

            <!-- Loading Progress Bar -->
            <div id="loadingProgress" style="display: none; margin: 10px 0;">
                <div style="background: var(--bg-primary); border-radius: 6px; padding: 12px; box-shadow: 0 1px 4px var(--card-shadow);">
                    <div style="margin-bottom: 6px; font-weight: 600; color: #667eea; font-size: 11px;">
                        <span id="progressStatus">Loading CSV...</span>
                    </div>
                    <div style="background: #e0e0e0; border-radius: 8px; height: 18px; overflow: hidden; position: relative;">
                        <div id="progressBar" style="background: linear-gradient(90deg, #667eea 0%, #764ba2 100%); height: 100%; width: 0%; transition: width 0.2s ease;">
                        </div>
                        <span id="progressPercent" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #333; font-weight: bold; font-size: 11px; text-shadow: 0 0 3px rgba(255,255,255,0.8);">0%</span>
                    </div>
                    <div style="margin-top: 5px; font-size: 10px; color: #666; display: flex; justify-content: space-between;">
                        <span id="progressRows">0 / 0 rows</span>
                        <span id="progressETA">Calculating...</span>
                    </div>
                </div>
            </div>

            <div class="filter-section" style="margin-top: 8px;">
                <div class="filter-group">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <label for="productFilter">Main Product</label>
                        <button class="clear-filter-btn" onclick="clearProductFilter()" title="Clear product filter">‚úï</button>
                    </div>
                    <select id="productFilter" multiple size="5">
                        <option value="">All Products</option>
                    </select>
                </div>
                <div class="filter-group">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <label for="projectTypeFilter">Project Type</label>
                        <button class="clear-filter-btn" onclick="clearProjectTypeFilter()" title="Clear project type filter">‚úï</button>
                    </div>
                    <select id="projectTypeFilter" multiple size="5">
                        <option value="">All Project Types</option>
                    </select>
                </div>
                <div class="filter-group">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <label for="departmentFilter">Department</label>
                        <button class="clear-filter-btn" onclick="clearDepartmentFilter()" title="Clear department filter">‚úï</button>
                    </div>
                    <select id="departmentFilter" multiple size="5">
                        <option value="">All Departments</option>
                    </select>
                </div>
            </div>

            <div class="filter-section" style="margin-top: 8px;">
                <div class="filter-group">
                    <label for="presetSelector">Saved Filter Presets</label>
                    <select id="presetSelector" onchange="if(this.value) loadFilterPreset(this.value)">
                        <option value="">Select a saved preset...</option>
                    </select>
                </div>
                <div class="filter-group" style="display: flex; flex-direction: row; gap: 8px; align-items: flex-end;">
                    <button class="btn-primary" onclick="saveFilterPreset()" title="Save current filters as a preset">üíæ Save Preset</button>
                    <button class="btn-secondary" onclick="if(document.getElementById('presetSelector').value) deleteFilterPreset(document.getElementById('presetSelector').value)" title="Delete selected preset">üóëÔ∏è Delete</button>
                </div>
            </div>

            <div class="button-group">
                <button class="btn-secondary" onclick="resetFilters()">Reset All Filters</button>
                <button class="btn-secondary" onclick="clearCache(); location.reload();" title="Clear cached data and reload">Clear Cache</button>
                <button class="btn-primary" onclick="exportToCSV()" title="Export filtered data to CSV">üì• Export to CSV</button>
                <small style="color: #6c757d; margin-left: 10px;">üí° Filters apply automatically when you select or change values</small>
            </div>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="switchView('detail')">üìã Detail View</div>
            <div class="tab" onclick="switchView('monthly')">üìÖ Monthly View</div>
            <div class="tab" onclick="switchView('kenpbi1')">üìä Ken.PBI.1</div>
            <div class="tab" onclick="switchView('pivotbuilder')">üîß Pivot Builder</div>
            <div class="tab" onclick="switchView('employees')">üë§ Employees</div>
            <div class="tab" onclick="switchView('charts')">üìà Charts</div>
            <div class="tab" onclick="switchView('compare')">üìä Compare</div>
            <div class="tab" onclick="switchView('insights')">üí° Insights</div>
            <div class="tab" onclick="switchView('recommendations')">üéØ Recommendations</div>
        </div>

        <!-- Detail View -->
        <div id="detailView" class="view-container active">

        <div class="stats" id="stats" style="display: none;">
            <div class="stat-card">
                <div class="stat-label">Total Records</div>
                <div class="stat-value" id="totalRecords">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Total Hours</div>
                <div class="stat-value" id="totalHours">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Unique Projects</div>
                <div class="stat-value" id="uniqueProjects">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Unique Products</div>
                <div class="stat-value" id="uniqueProducts">0</div>
            </div>
        </div>

        <div class="table-container">
            <div id="loadingIndicator" class="loading">
                <div class="spinner"></div>
                <p>Loading MIT Time Tracking Dataset...</p>
            </div>
            <div id="noData" class="no-data" style="display: none;">
                No data available.
            </div>
            <table id="dataTable" style="display: none;">
                <thead>
                    <tr>
                        <th class="sortable" data-column="mainProduct" data-type="string">Main Product</th>
                        <th class="sortable" data-column="customerProject" data-type="string">Customer:Project</th>
                        <th class="sortable" data-column="name" data-type="string">Name</th>
                        <th class="sortable" data-column="mtype2" data-type="string">Type</th>
                        <th class="sortable" data-column="task" data-type="string">Task</th>
                        <th class="sortable sort-desc" data-column="totalHours" data-type="number">Total Hours</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                </tbody>
                <tfoot id="tableFooter" style="display: none;">
                    <tr style="background: #f8f9fa; font-weight: bold; border-top: 3px solid #667eea;">
                        <td colspan="5" style="text-align: right; padding-right: 20px;">TOTAL:</td>
                        <td id="totalHoursFooter">0.00</td>
                    </tr>
                </tfoot>
            </table>
        </div>

        </div> <!-- End Detail View -->

        <!-- Monthly View -->
        <div id="monthlyView" class="view-container">

            <div class="stats" id="statsMonthly" style="display: none;">
                <div class="stat-card">
                    <div class="stat-label">Total Months</div>
                    <div class="stat-value" id="totalMonths">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Total Hours</div>
                    <div class="stat-value" id="totalHoursMonthly">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Avg Hours/Month</div>
                    <div class="stat-value" id="avgHoursMonthly">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Date Range</div>
                    <div class="stat-value" id="dateRangeMonthly" style="font-size: 1em;">-</div>
                </div>
            </div>

            <div class="table-container">
                <div id="loadingIndicatorMonthly" class="loading" style="display: none;">
                    <div class="spinner"></div>
                    <p>Processing monthly data...</p>
                </div>
                <div id="noDataMonthly" class="no-data" style="display: none;">
                    No data available.
                </div>
                <div id="monthlyTablesContainer">
                    <!-- Monthly tables will be dynamically inserted here -->
                </div>
            </div>

        </div> <!-- End Monthly View -->

        <!-- Ken.PBI.1 View -->
        <div id="kenpbi1View" class="view-container">
            <div class="stats" id="statsKenPBI1" style="display: none;">
                <div class="stat-card">
                    <div class="stat-label">Total Billing Types</div>
                    <div class="stat-value" id="totalBillingTypes">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Total Hours</div>
                    <div class="stat-value" id="totalHoursKenPBI1">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Total Records</div>
                    <div class="stat-value" id="totalRecordsKenPBI1">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Total Projects</div>
                    <div class="stat-value" id="totalProjectsKenPBI1">0</div>
                </div>
            </div>

            <div class="table-container">
                <div id="loadingIndicatorKenPBI1" class="loading" style="display: none;">
                    <div class="spinner"></div>
                    <p>Processing Ken.PBI.1 data...</p>
                </div>
                <div id="noDataKenPBI1" class="no-data" style="display: none;">
                    No data available.
                </div>
                <div id="kenPBI1TablesContainer">
                    <!-- Ken.PBI.1 pivot table will be dynamically inserted here -->
                </div>
            </div>
        </div> <!-- End Ken.PBI.1 View -->

        <!-- Pivot Builder View -->
        <div id="pivotbuilderView" class="view-container">
            <div style="padding: 20px 30px; background: var(--bg-primary);">
                <h2 style="color: var(--text-secondary); margin-bottom: 20px;">üîß Pivot Builder - Create Custom Pivot Tables</h2>

                <!-- Configuration Panel -->
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-bottom: 20px;">

                    <!-- Rows Configuration -->
                    <div style="background: var(--bg-secondary); padding: 15px; border-radius: 8px; border: 2px solid var(--border-color);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <h3 style="color: var(--text-secondary); margin: 0; font-size: 1em;">üìä Rows</h3>
                            <button onclick="addPivotRowField()" class="btn-secondary" style="padding: 4px 12px; font-size: 0.85em;">+ Add Row</button>
                        </div>
                        <p style="font-size: 0.85em; color: var(--text-tertiary); margin-bottom: 15px;">Drag to reorder ‚Ä¢ Click √ó to remove</p>

                        <div id="pivotRowsContainer" style="min-height: 50px;">
                            <!-- Dynamic row fields will be added here -->
                        </div>
                    </div>

                    <!-- Columns Configuration -->
                    <div style="background: var(--bg-secondary); padding: 15px; border-radius: 8px; border: 2px solid var(--border-color);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <h3 style="color: var(--text-secondary); margin: 0; font-size: 1em;">üìã Columns</h3>
                            <button onclick="addPivotColumnField()" class="btn-secondary" style="padding: 4px 12px; font-size: 0.85em;">+ Add Column</button>
                        </div>
                        <p style="font-size: 0.85em; color: var(--text-tertiary); margin-bottom: 15px;">Drag to reorder ‚Ä¢ Click √ó to remove</p>

                        <div id="pivotColumnsContainer" style="min-height: 50px;">
                            <!-- Dynamic column fields will be added here -->
                        </div>
                    </div>

                    <!-- Values/Measures Configuration -->
                    <div style="background: var(--bg-secondary); padding: 15px; border-radius: 8px; border: 2px solid var(--border-color);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <h3 style="color: var(--text-secondary); margin: 0; font-size: 1em;">üìà Values</h3>
                            <button onclick="addPivotMeasureField()" class="btn-secondary" style="padding: 4px 12px; font-size: 0.85em;">+ Add Measure</button>
                        </div>
                        <p style="font-size: 0.85em; color: var(--text-tertiary); margin-bottom: 15px;">Multiple measures ‚Ä¢ Click √ó to remove</p>

                        <div id="pivotMeasuresContainer" style="min-height: 50px;">
                            <!-- Dynamic measure fields will be added here -->
                        </div>
                    </div>
                </div>

                <!-- Presets Configuration -->
                <div style="background: var(--bg-secondary); padding: 15px; border-radius: 8px; border: 2px solid var(--border-color); margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h3 style="color: var(--text-secondary); margin: 0; font-size: 1em;">üíæ Pivot Presets</h3>
                        <div style="display: flex; gap: 10px;">
                            <button onclick="loadQuickPivot('monthlyByProduct')" class="btn-secondary" style="padding: 6px 12px; font-size: 0.85em;">üìÖ Monthly</button>
                            <button onclick="loadQuickPivot('billingByProject')" class="btn-secondary" style="padding: 6px 12px; font-size: 0.85em;">üí∞ Billing</button>
                            <button onclick="loadQuickPivot('employeeByMonth')" class="btn-secondary" style="padding: 6px 12px; font-size: 0.85em;">üë§ Employee</button>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr auto auto; gap: 10px; align-items: end;">
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 500; font-size: 0.9em; color: var(--text-primary);">Load Preset:</label>
                            <select id="pivotPresetSelector" onchange="loadPivotPreset()" style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid var(--border-color); background: var(--bg-primary); color: var(--text-primary);">
                                <option value="">-- Select Preset --</option>
                            </select>
                        </div>

                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 500; font-size: 0.9em; color: var(--text-primary);">Preset Name:</label>
                            <input type="text" id="pivotPresetName" placeholder="My Pivot Config" style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid var(--border-color); background: var(--bg-primary); color: var(--text-primary);">
                        </div>

                        <button onclick="savePivotPreset()" class="btn-secondary" style="padding: 8px 16px; font-size: 0.9em; white-space: nowrap;">üíæ Save</button>
                        <button onclick="deletePivotPreset()" class="btn-secondary" style="padding: 8px 16px; font-size: 0.9em; white-space: nowrap;">üóëÔ∏è Delete</button>
                    </div>
                </div>

                <!-- Options -->
                <div style="text-align: center; margin-bottom: 15px;">
                    <label style="font-size: 0.95em; cursor: pointer;">
                        <input type="checkbox" id="pivotColorHighlight" checked style="margin-right: 8px; cursor: pointer;">
                        üé® Color Highlight (Conditional Formatting)
                    </label>
                </div>

                <!-- Calculated Fields Panel -->
                <div id="calcFieldsPanel" style="margin: 20px 0; padding: 20px; background: var(--bg-secondary); border-radius: 8px; border: 2px solid #667eea;">
                    <h3 style="color: #667eea; margin-bottom: 15px; font-size: 1.1em;">üßÆ Calculated Fields</h3>
                    <p style="font-size: 0.85em; color: var(--text-tertiary); margin-bottom: 15px;">
                        Create custom fields using Excel-like formulas
                    </p>

                    <!-- Calculated Fields List -->
                    <div id="calcFieldsList" style="margin-bottom: 15px; min-height: 40px;">
                        <div style="text-align: center; color: var(--text-tertiary); font-size: 0.9em; padding: 10px;">
                            No calculated fields yet. Click "Add Calculated Field" to create one.
                        </div>
                    </div>

                    <!-- Add Field Button -->
                    <button onclick="openCalcFieldEditor()" class="btn-secondary" style="width: 100%;">
                        ‚ûï Add Calculated Field
                    </button>
                </div>

                <!-- Advanced Filters Panel -->
                <div id="pivotFiltersPanel" style="margin: 20px 0; padding: 20px; background: var(--bg-secondary); border-radius: 8px; border: 2px solid #17a2b8;">
                    <h3 style="color: #17a2b8; margin-bottom: 15px; font-size: 1.1em;">üîç Advanced Filters</h3>
                    <p style="font-size: 0.85em; color: var(--text-tertiary); margin-bottom: 15px;">
                        Add additional filters beyond the top filters. Note: Top filters (date range, main product, etc.) already apply automatically.
                    </p>

                    <!-- Filter Logic Toggle -->
                    <div style="margin-bottom: 15px;">
                        <label style="font-weight: 500; margin-right: 15px;">Filter Logic:</label>
                        <label style="margin-right: 20px; cursor: pointer;">
                            <input type="radio" name="pivotFilterLogic" value="AND" checked onchange="updatePivotFilterLogic()"> AND (all conditions must match)
                        </label>
                        <label style="cursor: pointer;">
                            <input type="radio" name="pivotFilterLogic" value="OR" onchange="updatePivotFilterLogic()"> OR (any condition matches)
                        </label>
                    </div>

                    <!-- Filter Rules List -->
                    <div id="pivotFilterRules" style="margin-bottom: 15px; min-height: 40px;">
                        <div style="text-align: center; color: var(--text-tertiary); font-size: 0.9em; padding: 10px;">
                            No filters added. Top filters (date, product, department) still apply. Click "Add Filter" to add more conditions.
                        </div>
                    </div>

                    <!-- Add Filter Button -->
                    <button onclick="addPivotFilterRule()" class="btn-secondary" style="width: 100%;">
                        ‚ûï Add Filter
                    </button>
                    <button onclick="clearAllPivotFilters()" class="btn-secondary" style="width: 100%; margin-top: 10px;">
                        üóëÔ∏è Clear All Filters
                    </button>
                </div>

                <!-- Build Button -->
                <div style="text-align: center; margin-bottom: 20px;">
                    <button onclick="buildPivotTable()" class="btn-primary" style="padding: 12px 40px; font-size: 1.1em;">
                        üîß Build Pivot Table
                    </button>
                    <button onclick="exportPivotTableToCSV()" class="btn-secondary" style="padding: 12px 30px; font-size: 1.0em; margin-left: 15px;">
                        üì• Export to CSV
                    </button>
                    <button onclick="exportPivotToExcel()" class="btn-secondary" style="padding: 12px 30px; font-size: 1.0em; margin-left: 10px;">
                        üìä Export to Excel
                    </button>
                    <p style="font-size: 0.85em; color: #6c757d; margin-top: 10px;">Configure rows, columns, and values above, then click to generate your custom pivot table. Export to CSV or Excel with formatting.</p>
                </div>

                <!-- Loading Indicator -->
                <div id="loadingIndicatorPivotBuilder" class="loading" style="display: none;">
                    <div class="spinner"></div>
                    <p>Building pivot table...</p>
                </div>

                <!-- Results Area -->
                <div id="pivotBuilderResults" style="display: none;">
                    <!-- Pivot table will be dynamically inserted here -->
                </div>

                <!-- Drill-down Modal -->
                <div id="drilldownModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--modal-bg); z-index: 10000; overflow: auto;">
                    <div style="position: relative; margin: 50px auto; max-width: 1200px; background: var(--bg-primary); border-radius: 12px; padding: 30px; box-shadow: 0 8px 32px rgba(0,0,0,0.3);">
                        <button onclick="closeDrilldownModal()" style="position: absolute; top: 15px; right: 15px; background: #dc3545; color: white; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; font-size: 1.1em;">‚úï Close</button>
                        <h2 style="margin-top: 0; color: var(--text-primary);">üìã Detail Records</h2>
                        <div id="drilldownContent"></div>
                    </div>
                </div>

                <!-- Calculated Field Editor Modal -->
                <div id="calcFieldEditorModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--modal-bg); z-index: 10001; overflow: auto;">
                    <div style="position: relative; margin: 50px auto; max-width: 800px; background: var(--bg-primary); border-radius: 12px; padding: 30px; box-shadow: 0 8px 32px rgba(0,0,0,0.3);">
                        <button onclick="closeCalcFieldEditor()" style="position: absolute; top: 15px; right: 15px; background: #dc3545; color: white; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; font-size: 1.1em;">‚úï Close</button>

                        <h2 style="margin-top: 0; color: var(--text-primary);">üßÆ Calculated Field Editor</h2>
                        <p style="color: var(--text-tertiary); font-size: 0.9em; margin-bottom: 20px;">
                            Create custom fields using Excel-like formulas
                        </p>

                        <!-- Field Name -->
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-primary);">Field Name:</label>
                            <input type="text" id="calcFieldName" placeholder="e.g., Billable Hours"
                                   style="width: 100%; padding: 10px; border: 2px solid var(--border-color); border-radius: 6px; font-size: 1em; background: var(--bg-primary); color: var(--text-primary);">
                        </div>

                        <!-- Formula Editor -->
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-primary);">Formula:</label>
                            <textarea id="calcFieldFormula" rows="4" placeholder="e.g., IF(BILLABLE='true', DURATION, 0)"
                                      style="width: 100%; padding: 10px; border: 2px solid var(--border-color); border-radius: 6px; font-size: 1em; font-family: 'Courier New', monospace; background: var(--bg-primary); color: var(--text-primary);"></textarea>
                            <div style="font-size: 0.85em; color: var(--text-tertiary); margin-top: 5px;">
                                Use field names (DURATION, BILLABLE, EMPLOYEE, etc.) and functions (IF, SUM, AVG, etc.)
                            </div>
                        </div>

                        <!-- Field Reference Helper -->
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-primary);">Insert Field:</label>
                            <select id="calcFieldInsert" onchange="insertFieldReference()"
                                    style="width: 100%; padding: 10px; border: 2px solid var(--border-color); border-radius: 6px; font-size: 1em; background: var(--bg-primary); color: var(--text-primary);">
                                <option value="">-- Select Field to Insert --</option>
                                <option value="DURATION">DURATION - Duration in hours</option>
                                <option value="BILLABLE">BILLABLE - Billable flag (true/false)</option>
                                <option value="EMPLOYEE">EMPLOYEE - Employee name</option>
                                <option value="PROJECT">PROJECT - Customer:Project</option>
                                <option value="DEPARTMENT">DEPARTMENT - Department</option>
                                <option value="TYPE">TYPE - Type/Category</option>
                                <option value="TASK">TASK - Task description</option>
                                <option value="MAIN_PRODUCT">MAIN_PRODUCT - Main product</option>
                                <option value="PROJECT_TYPE">PROJECT_TYPE - Project type</option>
                                <option value="MANAGER">MANAGER - Manager name</option>
                                <option value="TEAM">TEAM - Team name</option>
                                <option value="JOB_GROUP">JOB_GROUP - Job group</option>
                            </select>
                        </div>

                        <!-- Function Helper -->
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-primary);">Insert Function:</label>
                            <select id="calcFunctionInsert" onchange="insertFunction()"
                                    style="width: 100%; padding: 10px; border: 2px solid var(--border-color); border-radius: 6px; font-size: 1em; background: var(--bg-primary); color: var(--text-primary);">
                                <option value="">-- Select Function to Insert --</option>
                                <option value="IF(condition, true_val, false_val)">IF - Conditional logic</option>
                                <option value="SUM(value1, value2, ...)">SUM - Add values</option>
                                <option value="AVG(value1, value2, ...)">AVG - Average values</option>
                                <option value="COUNT(value1, value2, ...)">COUNT - Count values</option>
                                <option value="MAX(value1, value2, ...)">MAX - Maximum value</option>
                                <option value="MIN(value1, value2, ...)">MIN - Minimum value</option>
                                <option value="ABS(value)">ABS - Absolute value</option>
                                <option value="ROUND(value, decimals)">ROUND - Round number</option>
                                <option value="CONCAT(value1, value2, ...)">CONCAT - Concatenate text</option>
                            </select>
                        </div>

                        <!-- Validation Status -->
                        <div id="calcFieldValidation" style="display: none; margin-bottom: 20px; padding: 15px; border-radius: 6px;"></div>

                        <!-- Preview Results -->
                        <div id="calcFieldPreview" style="display: none; margin-bottom: 20px; padding: 15px; background: var(--bg-secondary); border-radius: 6px; border: 2px solid var(--border-color);">
                            <strong style="color: var(--text-primary);">Preview (first 5 rows):</strong>
                            <div id="calcFieldPreviewContent" style="margin-top: 10px; font-family: 'Courier New', monospace; font-size: 0.9em;"></div>
                        </div>

                        <!-- Action Buttons -->
                        <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 20px;">
                            <button onclick="validateCalcField()" class="btn-secondary" style="flex: 1; min-width: 150px;">
                                üîç Validate
                            </button>
                            <button onclick="previewCalcField()" class="btn-secondary" style="flex: 1; min-width: 150px;">
                                üëÅÔ∏è Preview
                            </button>
                            <button onclick="saveCalcField()" class="btn-primary" style="flex: 1; min-width: 150px;">
                                üíæ Save Field
                            </button>
                            <button onclick="closeCalcFieldEditor()" class="btn-secondary" style="flex: 1; min-width: 150px;">
                                Cancel
                            </button>
                        </div>

                        <!-- Hidden field for editing mode -->
                        <input type="hidden" id="calcFieldEditingId" value="">
                    </div>
                </div>
            </div>
        </div> <!-- End Pivot Builder View -->

        <!-- Settings Modal -->
        <div id="settingsModal" class="settings-modal">
            <div class="settings-content">
                <div class="settings-header">
                    <div class="settings-title">‚öôÔ∏è Settings</div>
                    <button class="settings-close" onclick="closeSettings()">‚úï Close</button>
                </div>

                <div class="settings-section">
                    <div class="settings-section-title">Display</div>

                    <div class="setting-item">
                        <div class="setting-label">
                            <div class="setting-name">üåì Dark Mode</div>
                            <div class="setting-description">Follows system preference automatically</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="darkModeToggle" onchange="toggleDarkMode()">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <div class="settings-section">
                    <div class="settings-section-title">Data Format</div>

                    <div class="setting-item">
                        <div class="setting-label">
                            <div class="setting-name">üî¢ Decimal Separator</div>
                            <div class="setting-description">Choose decimal point or comma</div>
                        </div>
                        <select id="decimalSeparator" class="setting-select" onchange="saveDecimalSeparator()">
                            <option value="period">Period (1.5)</option>
                            <option value="comma">Comma (1,5)</option>
                        </select>
                    </div>
                </div>

                <div class="settings-section">
                    <div class="settings-section-title">Workforce Planning</div>

                    <div class="setting-item">
                        <div class="setting-label">
                            <div class="setting-name">‚è±Ô∏è Norm Hours per Week</div>
                            <div class="setting-description">Standard working hours per week by subsidiary</div>
                        </div>
                    </div>

                    <div class="setting-item" style="padding-left: 20px;">
                        <div class="setting-label">
                            <div class="setting-name" style="font-size: 0.9em;">EGDK (Denmark)</div>
                        </div>
                        <input type="number" id="normHoursEGDK" class="setting-input" min="1" max="80" step="0.5" value="37" onchange="saveNormHours()">
                    </div>

                    <div class="setting-item" style="padding-left: 20px;">
                        <div class="setting-label">
                            <div class="setting-name" style="font-size: 0.9em;">EGXX</div>
                        </div>
                        <input type="number" id="normHoursEGXX" class="setting-input" min="1" max="80" step="0.5" value="37" onchange="saveNormHours()">
                    </div>

                    <div class="setting-item" style="padding-left: 20px;">
                        <div class="setting-label">
                            <div class="setting-name" style="font-size: 0.9em;">ZASE</div>
                        </div>
                        <input type="number" id="normHoursZASE" class="setting-input" min="1" max="80" step="0.5" value="37" onchange="saveNormHours()">
                    </div>

                    <div class="setting-item" style="padding-left: 20px;">
                        <div class="setting-label">
                            <div class="setting-name" style="font-size: 0.9em;">EGPL (Poland)</div>
                        </div>
                        <input type="number" id="normHoursEGPL" class="setting-input" min="1" max="80" step="0.5" value="40" onchange="saveNormHours()">
                    </div>

                    <div class="setting-item" style="padding-left: 20px;">
                        <div class="setting-label">
                            <div class="setting-name" style="font-size: 0.9em;">EGSU (Sweden)</div>
                        </div>
                        <input type="number" id="normHoursEGSU" class="setting-input" min="1" max="80" step="0.5" value="40" onchange="saveNormHours()">
                    </div>

                    <div class="setting-item" style="padding-left: 20px;">
                        <div class="setting-label">
                            <div class="setting-name" style="font-size: 0.9em;">Other</div>
                        </div>
                        <input type="number" id="normHoursOther" class="setting-input" min="1" max="80" step="0.5" value="37" onchange="saveNormHours()">
                    </div>
                </div>
            </div>
        </div>

        <!-- Data Import Modal -->
        <div id="dataImportModal" class="settings-modal" style="display: none;">
            <div class="settings-content">
                <div class="settings-header">
                    <div class="settings-title">üìÅ Data Import</div>
                    <button class="settings-close" onclick="closeDataImportModal()">‚úï Close</button>
                </div>
                <div style="padding: 20px;">
                    <!-- File Upload Section -->
                    <div style="margin-bottom: 30px;">
                        <h3 style="margin: 0 0 15px 0; font-size: 1.1em; color: var(--text-primary);">üìÇ Load CSV File</h3>
                        <div class="file-upload">
                            <label for="csvFileModal" class="file-label">Choose CSV File</label>
                            <input type="file" id="csvFileModal" accept=".csv" style="display: none;">
                            <p id="fileNameModal" style="margin: 10px 0 0 0; font-size: 0.9em; color: var(--text-secondary);">
                                Select a NetSuite time tracking CSV file to import
                            </p>
                        </div>

                        <!-- Progress Indicator -->
                        <div id="modalProgress" style="display: none; margin-top: 20px; padding: 15px; background: var(--bg-secondary); border-radius: 6px; border-left: 4px solid #667eea;">
                            <div class="loading" style="display: flex; align-items: center; gap: 15px;">
                                <div class="spinner"></div>
                                <div>
                                    <div id="modalProgressText" style="font-weight: 600; margin-bottom: 5px;">Loading...</div>
                                    <div id="modalProgressDetail" style="font-size: 0.85em; color: var(--text-secondary);">Preparing to load file...</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Import Statistics Section -->
                    <div id="modalStatsSection" style="border-top: 2px solid var(--border-color); padding-top: 25px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h3 style="margin: 0; font-size: 1.1em; color: var(--text-primary);">üìä Last Import Statistics</h3>
                            <button onclick="openImportStats()" style="padding: 8px 16px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.9em;">
                                View Details
                            </button>
                        </div>
                        <div id="modalStatsSummary" style="font-size: 0.9em; color: var(--text-secondary);">
                            No import data available yet. Upload a file to see statistics.
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Import Statistics Modal (Detailed View) -->
        <div id="importStatsModal" class="settings-modal" style="display: none;">
            <div class="settings-content">
                <div class="settings-header">
                    <div class="settings-title">üìä Import Statistics</div>
                    <button class="settings-close" onclick="closeImportStats()">‚úï Close</button>
                </div>
                <div id="importStatsContent">
                    <!-- Content will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Anomaly Detection Modal -->
        <div id="anomalyDetectionModal" class="settings-modal" style="display: none;">
            <div class="settings-content">
                <div class="settings-header">
                    <div class="settings-title">‚ö†Ô∏è Anomaly Detection</div>
                    <button class="settings-close" onclick="closeAnomalyDetectionModal()">‚úï Close</button>
                </div>
                <div style="padding: 20px;">
                    <h3 style="margin: 0 0 10px 0; font-size: 1.1em; color: var(--text-primary);">‚ö†Ô∏è Anomaly Whitelist</h3>
                    <p style="margin: 0 0 20px 0; font-size: 0.9em; color: var(--text-secondary);">Configure employees who should be excluded from certain anomaly checks</p>

                    <!-- Weekend Work Exemptions -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="margin: 0 0 5px 0; font-size: 0.95em; color: var(--text-primary);">Weekend Work Exemptions</h4>
                        <p style="margin: 0 0 8px 0; font-size: 0.85em; color: var(--text-tertiary);">Employees allowed to work weekends (e.g., IT support, consultants)</p>
                        <textarea id="weekendWhitelist" rows="3" placeholder="Enter employee names, one per line&#10;Example:&#10;John Smith&#10;Jane Doe" onchange="saveAnomalyWhitelist()" style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 4px; font-family: inherit; font-size: 0.9em; background: var(--bg-primary); color: var(--text-primary);"></textarea>
                    </div>

                    <!-- Time Gap Exemptions -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="margin: 0 0 5px 0; font-size: 0.95em; color: var(--text-primary);">Time Gap Exemptions</h4>
                        <p style="margin: 0 0 8px 0; font-size: 0.85em; color: var(--text-tertiary);">Employees exempt from time tracking gap detection (e.g., part-time, contractors)</p>
                        <textarea id="timeGapWhitelist" rows="3" placeholder="Enter employee names, one per line&#10;Example:&#10;Part Time Employee&#10;Contractor Name" onchange="saveAnomalyWhitelist()" style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 4px; font-family: inherit; font-size: 0.9em; background: var(--bg-primary); color: var(--text-primary);"></textarea>
                    </div>

                    <!-- Excessive Hours Exemptions -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="margin: 0 0 5px 0; font-size: 0.95em; color: var(--text-primary);">Excessive Hours Exemptions</h4>
                        <p style="margin: 0 0 8px 0; font-size: 0.85em; color: var(--text-tertiary);">Employees exempt from excessive hours detection (e.g., managers, special roles)</p>
                        <textarea id="excessiveHoursWhitelist" rows="3" placeholder="Enter employee names, one per line&#10;Example:&#10;Manager Name&#10;On-Call Engineer" onchange="saveAnomalyWhitelist()" style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 4px; font-family: inherit; font-size: 0.9em; background: var(--bg-primary); color: var(--text-primary);"></textarea>
                    </div>

                    <!-- Action Buttons -->
                    <div style="display: flex; gap: 10px;">
                        <button onclick="clearAnomalyWhitelist()" style="padding: 10px 20px; background: #dc3545; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">
                            Clear All Whitelists
                        </button>
                        <button onclick="loadAnomalyWhitelist(true)" style="padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">
                            Reload from Storage
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Insights View -->
        <div id="insightsView" class="view-container">

            <div class="stats" id="statsInsights" style="display: none;">
                <div class="stat-card">
                    <div class="stat-label">Total Records</div>
                    <div class="stat-value" id="totalRecordsInsights">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Total Hours</div>
                    <div class="stat-value" id="totalHoursInsights">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Unique Projects</div>
                    <div class="stat-value" id="uniqueProjectsInsights">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Unique Products</div>
                    <div class="stat-value" id="uniqueProductsInsights">0</div>
                </div>
            </div>

            <!-- Time Distribution Insights -->
            <div id="timeInsights" style="display: none; padding: 10px 30px; background: #f8f9fa; border-bottom: 1px solid #e9ecef;">
                <!-- Insights will be dynamically populated here -->
            </div>

            <!-- Additional Analytics Dashboard -->
            <div id="additionalAnalytics" style="display: none; padding: 10px 30px; background: #f8f9fa; border-bottom: 1px solid #e9ecef;">
                <!-- Additional analytics will be dynamically populated here -->
            </div>

            <!-- Suggested Improvements Section -->
            <div id="suggestedImprovements" style="display: none; padding: 10px 30px; background: #fff3cd; border-bottom: 1px solid #ffc107;">
                <!-- Suggested improvements will be dynamically populated here -->
            </div>

            <!-- Comprehensive Dashboard Section (New) -->
            <div id="comprehensiveDashboard" style="display: none; padding: 20px 30px; background: var(--bg-primary);">
                <!-- Comprehensive analytics dashboard will be dynamically populated here -->
            </div>

        </div> <!-- End Insights View -->

        <!-- Recommendations View -->
        <div id="recommendationsView" class="view-container">
            <div class="recommendations-container">
                <div class="recommendations-header">
                    <h2 class="recommendations-title">üéØ Smart Recommendations Engine</h2>
                    <button onclick="refreshRecommendations()" style="padding: 10px 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">
                        üîÑ Refresh Analysis
                    </button>
                </div>

                <!-- Summary Cards -->
                <div class="recommendations-summary" id="recSummary">
                    <div class="rec-summary-card critical">
                        <div class="rec-summary-number" id="criticalCount">0</div>
                        <div class="rec-summary-label">Critical Issues</div>
                    </div>
                    <div class="rec-summary-card warning">
                        <div class="rec-summary-number" id="warningCount">0</div>
                        <div class="rec-summary-label">Warnings</div>
                    </div>
                    <div class="rec-summary-card info">
                        <div class="rec-summary-number" id="infoCount">0</div>
                        <div class="rec-summary-label">Info</div>
                    </div>
                    <div class="rec-summary-card success">
                        <div class="rec-summary-number" id="successCount">0</div>
                        <div class="rec-summary-label">Good Practices</div>
                    </div>
                </div>

                <!-- Filter Chips -->
                <div class="recommendations-filters" id="recFilters">
                    <div class="filter-chip active" data-filter="all" onclick="filterRecommendations('all')">
                        All Recommendations
                    </div>
                    <div class="filter-chip" data-filter="critical" onclick="filterRecommendations('critical')">
                        Critical
                    </div>
                    <div class="filter-chip" data-filter="warning" onclick="filterRecommendations('warning')">
                        Warnings
                    </div>
                    <div class="filter-chip" data-filter="info" onclick="filterRecommendations('info')">
                        Info
                    </div>
                    <div class="filter-chip" data-filter="resource" onclick="filterRecommendations('resource')">
                        Resource Management
                    </div>
                    <div class="filter-chip" data-filter="billing" onclick="filterRecommendations('billing')">
                        Billing Optimization
                    </div>
                    <div class="filter-chip" data-filter="quality" onclick="filterRecommendations('quality')">
                        Data Quality
                    </div>
                    <div class="filter-chip" data-filter="project" onclick="filterRecommendations('project')">
                        Project Health
                    </div>
                </div>

                <!-- Recommendations List -->
                <div class="recommendations-list" id="recommendationsList">
                    <!-- Recommendations will be dynamically populated here -->
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Analyzing your data...</p>
                    </div>
                </div>

                <!-- Anomalies Container -->
                <div class="recommendations-list" id="anomaliesContainer">
                    <!-- Anomalies will be dynamically populated here -->
                </div>
            </div>
        </div> <!-- End Recommendations View -->

        <!-- Employees View -->
        <div id="employeesView" class="view-container">
            <div class="stats" id="statsEmployees" style="display: none;">
                <div class="stat-card">
                    <div class="stat-label">Total Employees</div>
                    <div class="stat-value" id="totalEmployees">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Total Hours</div>
                    <div class="stat-value" id="totalHoursEmployees">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Billable Hours</div>
                    <div class="stat-value" id="billableHoursEmployees">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Non-Billable Hours</div>
                    <div class="stat-value" id="nonBillableHoursEmployees">0</div>
                </div>
            </div>

            <div id="loadingIndicatorEmployees" class="loading" style="display: none;">
                <div class="spinner"></div>
                <p>Loading employee data...</p>
            </div>

            <!-- 12-Month Trend Chart -->
            <div style="padding: 20px 30px; background: var(--bg-primary);">
                <h3 style="color: var(--text-secondary); margin-bottom: 15px;">üìä Employee Hours Trend - Last 12 Months</h3>
                <div style="position: relative; height: 400px; max-height: 600px;">
                    <canvas id="employeeTrendChart"></canvas>
                </div>
            </div>

            <!-- Employee Detail Table -->
            <div style="padding: 0 30px 30px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin: 20px 0 10px;">
                    <h3 style="color: var(--text-secondary); margin: 0;">üë§ Employee Details</h3>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <label style="font-size: 0.9em; color: var(--text-secondary);">Filter Employees:</label>
                        <div class="employee-filter-container">
                            <button id="employeeFilterButton" onclick="toggleEmployeeFilter()" class="employee-filter-button">
                                <span id="employeeFilterLabel">All Employees</span>
                                <span style="margin-left: 8px;">‚ñº</span>
                            </button>
                            <div id="employeeFilterDropdown" class="employee-filter-dropdown" style="display: none;">
                                <div style="padding: 8px; border-bottom: 1px solid var(--border-color);">
                                    <input type="text" id="employeeSearchBox" placeholder="Search..." oninput="filterEmployeeList()" style="width: 100%; padding: 6px; border: 1px solid var(--border-color); border-radius: 4px; background: var(--bg-primary); color: var(--text-primary);">
                                </div>
                                <div style="padding: 8px; border-bottom: 1px solid var(--border-color);">
                                    <label style="display: flex; align-items: center; cursor: pointer;">
                                        <input type="checkbox" id="selectAllEmployees" onchange="toggleSelectAllEmployees()" checked style="margin-right: 8px;">
                                        <span style="font-weight: 600;">(Select All)</span>
                                    </label>
                                </div>
                                <div id="employeeCheckboxList" style="max-height: 300px; overflow-y: auto; padding: 8px;">
                                    <!-- Employee checkboxes will be populated here -->
                                </div>
                                <div style="padding: 8px; border-top: 1px solid var(--border-color); display: flex; gap: 8px;">
                                    <button onclick="applyEmployeeFilter()" style="flex: 1; padding: 6px; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer;">Apply</button>
                                    <button onclick="clearEmployeeFilter()" style="padding: 6px 12px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer;">Clear</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div style="overflow-x: auto;">
                    <table>
                        <thead>
                            <tr>
                                <th class="sortable" data-column="employeeName" data-type="string">Employee Name</th>
                                <th class="sortable" data-column="subsidiary" data-type="string">Subsidiary</th>
                                <th class="sortable" data-column="totalHours" data-type="number">Total Hours</th>
                                <th class="sortable" data-column="normHours" data-type="number">Norm Hours</th>
                                <th class="sortable" data-column="utilizationPercent" data-type="number">Utilization %</th>
                                <th class="sortable" data-column="billableHours" data-type="number">Billable Hours</th>
                                <th class="sortable" data-column="nonBillableHours" data-type="number">Non-Billable Hours</th>
                                <th class="sortable" data-column="billablePercent" data-type="number">Billable %</th>
                                <th class="sortable" data-column="billableVsDept" data-type="number" title="Billable % compared to department average">vs Dept Avg</th>
                                <th class="sortable" data-column="billableVsJobGroup" data-type="number" title="Billable % compared to job group average">vs Job Group Avg</th>
                                <th data-column="topTasks">Top Tasks/Projects</th>
                            </tr>
                        </thead>
                        <tbody id="employeeTableBody">
                            <!-- Employee rows will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>

        </div> <!-- End Employees View -->

        <!-- Charts View -->
        <div id="chartsView" class="view-container">
            <div style="padding: 20px 30px; background: var(--bg-primary);">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="color: var(--text-secondary);">üìà Visual Analytics</h2>
                    <button onclick="scrollToTop()" class="btn-primary" style="padding: 8px 15px;">‚¨Ü Back to Top</button>
                </div>

                <!-- Quick Navigation -->
                <div style="background: var(--bg-secondary); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <strong style="color: var(--text-primary);">Jump to:</strong>
                    <a href="#timeTrendSection" style="margin-left: 15px; color: #007bff; text-decoration: none;">Time Trend</a> |
                    <a href="#billingPieSection" style="margin-left: 10px; color: #007bff; text-decoration: none;">Billing Distribution</a> |
                    <a href="#topProjectsSection" style="margin-left: 10px; color: #007bff; text-decoration: none;">Top Projects</a>
                </div>

                <!-- Time Trend Chart -->
                <div id="timeTrendSection" style="background: var(--bg-primary); padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px var(--card-shadow); margin-bottom: 30px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h3 style="color: var(--text-tertiary); margin: 0;">üìä Time Trend</h3>
                        <button onclick="scrollToTop()" style="padding: 5px 10px; background: var(--bg-secondary); border: 1px solid var(--border-color); color: var(--text-primary); border-radius: 4px; cursor: pointer;">‚¨Ü Top</button>
                    </div>
                    <div style="position: relative; height: 400px; max-height: 600px;">
                        <canvas id="timeTrendChart"></canvas>
                    </div>
                </div>

                <!-- Billing Type Pie Chart -->
                <div id="billingPieSection" style="background: var(--bg-primary); padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px var(--card-shadow); margin-bottom: 30px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h3 style="color: var(--text-tertiary); margin: 0;">ü•ß Billing Type Distribution</h3>
                        <button onclick="scrollToTop()" style="padding: 5px 10px; background: var(--bg-secondary); border: 1px solid var(--border-color); color: var(--text-primary); border-radius: 4px; cursor: pointer;">‚¨Ü Top</button>
                    </div>
                    <div style="position: relative; height: 400px; max-height: 600px;">
                        <canvas id="billingPieChart"></canvas>
                    </div>
                </div>

                <!-- Top Projects Bar Chart -->
                <div id="topProjectsSection" style="background: var(--bg-primary); padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px var(--card-shadow); margin-bottom: 30px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h3 style="color: var(--text-tertiary); margin: 0;">üìä Top 10 Projects by Hours</h3>
                        <button onclick="scrollToTop()" style="padding: 5px 10px; background: var(--bg-secondary); border: 1px solid var(--border-color); color: var(--text-primary); border-radius: 4px; cursor: pointer;">‚¨Ü Top</button>
                    </div>
                    <div style="position: relative; height: 500px; max-height: 800px;">
                        <canvas id="topProjectsChart"></canvas>
                    </div>
                </div>
            </div>
        </div> <!-- End Charts View -->

        <!-- Compare View -->
        <div id="compareView" class="view-container">
            <div style="padding: 20px 30px; background: #e7f3ff;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="color: #1976D2;">üìä Compare Periods (Up to 4)</h2>
                    <button onclick="scrollToTop()" class="btn-primary" style="padding: 8px 15px;">‚¨Ü Back to Top</button>
                </div>

                <!-- Quick Date Filters -->
                <div style="background: var(--bg-primary); padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px var(--card-shadow); margin-bottom: 20px;">
                    <h3 style="margin-bottom: 10px; color: var(--text-secondary); font-size: 1em;">‚ö° Quick Filters</h3>
                    <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                        <button onclick="setQuickPeriod(1, 'thisMonth')" class="btn-secondary" style="padding: 6px 12px; font-size: 0.9em;">This Month</button>
                        <button onclick="setQuickPeriod(1, 'lastMonth')" class="btn-secondary" style="padding: 6px 12px; font-size: 0.9em;">Last Month</button>
                        <button onclick="setQuickPeriod(1, 'thisQuarter')" class="btn-secondary" style="padding: 6px 12px; font-size: 0.9em;">This Quarter</button>
                        <button onclick="setQuickPeriod(1, 'lastQuarter')" class="btn-secondary" style="padding: 6px 12px; font-size: 0.9em;">Last Quarter</button>
                        <button onclick="setQuickPeriod(1, 'thisYear')" class="btn-secondary" style="padding: 6px 12px; font-size: 0.9em;">This Year</button>
                        <button onclick="setQuickPeriod(1, 'lastYear')" class="btn-secondary" style="padding: 6px 12px; font-size: 0.9em;">Last Year</button>
                        <button onclick="setQuickPeriod(1, 'last7Days')" class="btn-secondary" style="padding: 6px 12px; font-size: 0.9em;">Last 7 Days</button>
                        <button onclick="setQuickPeriod(1, 'last30Days')" class="btn-secondary" style="padding: 6px 12px; font-size: 0.9em;">Last 30 Days</button>
                        <button onclick="setQuickPeriod(1, 'last90Days')" class="btn-secondary" style="padding: 6px 12px; font-size: 0.9em;">Last 90 Days</button>
                    </div>
                    <p style="margin-top: 10px; font-size: 0.85em; color: var(--text-tertiary);">üí° Click any button to set Period 1. Change the dropdown to set Period 2, 3, or 4.</p>
                    <div style="margin-top: 10px;">
                        <label style="font-size: 0.9em; margin-right: 8px; color: var(--text-primary);">Apply to:</label>
                        <select id="quickFilterTarget" style="padding: 4px 8px; border-radius: 4px; border: 1px solid var(--border-color); background: var(--bg-primary); color: var(--text-primary);">
                            <option value="1">Period 1</option>
                            <option value="2">Period 2</option>
                            <option value="3">Period 3</option>
                            <option value="4">Period 4</option>
                        </select>
                    </div>
                </div>

                <!-- Period Selection -->
                <div style="background: var(--bg-primary); padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px var(--card-shadow);">
                    <h3 style="margin-bottom: 15px; color: var(--text-secondary);">Select Date Ranges</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 15px;">
                        <div>
                            <label style="display: block; font-weight: bold; margin-bottom: 5px;">Period 1:</label>
                            <input type="text" id="comparePeriod1From" placeholder="DD/MM/YYYY" style="width: 48%; padding: 8px; margin-right: 4%;">
                            <input type="text" id="comparePeriod1To" placeholder="DD/MM/YYYY" style="width: 48%; padding: 8px;">
                        </div>
                        <div>
                            <label style="display: block; font-weight: bold; margin-bottom: 5px;">Period 2:</label>
                            <input type="text" id="comparePeriod2From" placeholder="DD/MM/YYYY" style="width: 48%; padding: 8px; margin-right: 4%;">
                            <input type="text" id="comparePeriod2To" placeholder="DD/MM/YYYY" style="width: 48%; padding: 8px;">
                        </div>
                        <div>
                            <label style="display: block; font-weight: bold; margin-bottom: 5px;">Period 3:</label>
                            <input type="text" id="comparePeriod3From" placeholder="DD/MM/YYYY" style="width: 48%; padding: 8px; margin-right: 4%;">
                            <input type="text" id="comparePeriod3To" placeholder="DD/MM/YYYY" style="width: 48%; padding: 8px;">
                        </div>
                        <div>
                            <label style="display: block; font-weight: bold; margin-bottom: 5px;">Period 4:</label>
                            <input type="text" id="comparePeriod4From" placeholder="DD/MM/YYYY" style="width: 48%; padding: 8px; margin-right: 4%;">
                            <input type="text" id="comparePeriod4To" placeholder="DD/MM/YYYY" style="width: 48%; padding: 8px;">
                        </div>
                    </div>
                    <button class="btn-primary" onclick="comparePeriods()" style="margin-bottom: 15px;">Compare Periods</button>
                    <div id="compareResults" style="display: none;">
                        <!-- Comparison results will be displayed here -->
                    </div>
                </div>

                <!-- Comparison Chart -->
                <div id="compareChartSection" style="display: none; background: var(--bg-primary); padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px var(--card-shadow); margin-top: 20px;">
                    <h3 style="margin-bottom: 15px; color: var(--text-secondary);">üìä Visual Comparison</h3>
                    <div style="position: relative; height: 400px; max-height: 600px;">
                        <canvas id="compareChart"></canvas>
                    </div>
                </div>
            </div>
        </div> <!-- End Compare View -->

    </div>

    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="app.js"></script>
</body>
</html>
